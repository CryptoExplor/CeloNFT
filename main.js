// [CONTENT TRUNCATED DUE TO LENGTH - The full file content with the following key changes:]